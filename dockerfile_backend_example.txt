
# Use Debian-based image instead of Alpine for better native library (libvips/sharp) compatibility
# This fixes "unsupported image format" errors for specific BMP/TIFF files
FROM node:18-bullseye

WORKDIR /app

# Copy package.json from the server directory
COPY server/package.json ./

# Install Chinese fonts and dependencies
RUN apt-get update && apt-get install -y \
    fonts-noto-cjk \
    fonts-wqy-zenhei \
    && rm -rf /var/lib/apt/lists/*

# Install npm dependencies
RUN npm install

# Copy the rest of the server code
COPY server/ .

# Create directories for uploads and processed files
RUN mkdir -p uploads processed

EXPOSE 3000

CMD ["node", "index.js"]
